---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    fig_caption: yes
    keep_md: yes
---

## Make sure all required packages are loaded.

```{r loadpackages, echo = TRUE}
library(ggplot2)
library(knitr)
```

## Loading and preprocessing the data

```{r load, echo=TRUE}
unzip("activity.zip")
data <- read.csv("activity.csv")
```


## What is mean total number of steps taken per day?

Histogram of the total number of steps taken day by day:

```{r}

total_per_day <- tapply(data$steps, data$date, sum)
hist(total_per_day, breaks = 15, main = "Frequency of Total Steps Taken Per Day", xlab = "Total number of steps", col = "lightblue")
mean(total_per_day, na.rm = TRUE)
median(total_per_day, na.rm = TRUE)

```

## What is the average daily activity pattern?

Plot of the average number of steps, across all days:

```{r}
average_per_interval <- aggregate(list(data$steps), by = list(data$interval), FUN = mean, na.rm = TRUE)

colnames(average_per_interval) <- c("Interval", "Average Steps")

plot(average_per_interval, type="l")

average_per_interval.max = average_per_interval[average_per_interval[2] == max(average_per_interval[2]), 1]
```


## Imputing missing values

```{r}
colSums(is.na(data))[1]
```

I use the mean for 5-minute interval as replacement for the missing values.

```{r}
library(plyr)

na_replaced <- ddply(data, .(interval), transform, steps = ifelse(is.na(steps), round(mean(steps, na.rm=TRUE)), steps), digits = 0)

new_total_per_day <- tapply(na_replaced$steps, na_replaced$date, sum)

hist(new_total_per_day, breaks = 15, main = "Frequency of Total Steps Taken Per Day (NAs Replaced)", xlab = "Total number of steps", col = "lightblue")

mean(new_total_per_day)

median(new_total_per_day)
```

## Are there differences in activity patterns between weekdays and weekends?

```{r}
na_replaced$day <- ifelse(weekdays(as.Date(na_replaced$date)) == "Sunday", "Weekend", ifelse(weekdays(as.Date(na_replaced$date)) == "Saturday", "Weekend", "Weekday"))

average_by_interval_and_day <- aggregate(steps ~ interval + day, data = na_replaced, mean)

library(lattice)

xyplot(average_by_interval_and_day$steps ~ average_by_interval_and_day$interval | average_by_interval_and_day$day, average_by_interval_and_day, layout = c(1, 2), type = "l", xlab = "Interval", ylab = "Steps")

```


